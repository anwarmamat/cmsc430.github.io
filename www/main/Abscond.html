<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4&nbsp;Abscond: a language of numbers</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra.css" title="default"/><link rel="stylesheet" type="text/css" href="fancyverb.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="accessibility.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">CMSC 430:<span class="mywbr"> &nbsp;</span> Design and Implementation of Programming Languages</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="Syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a></td></tr><tr><td align="right"></td><td><a href="Texts.html" class="tocviewlink" data-pltdoc="x">Texts</a></td></tr><tr><td align="right"></td><td><a href="Schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a></td></tr><tr><td align="right"></td><td><a href="Notes.html" class="tocviewselflink" data-pltdoc="x">Notes</a></td></tr><tr><td align="right"></td><td><a href="Assignments.html" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr><tr><td align="right"></td><td><a href="Midterms.html" class="tocviewlink" data-pltdoc="x">Midterms</a></td></tr><tr><td align="right"></td><td><a href="Project.html" class="tocviewlink" data-pltdoc="x">Project</a></td></tr><tr><td align="right"></td><td><a href="Software.html" class="tocviewlink" data-pltdoc="x">Software</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="Notes.html" class="tocviewlink" data-pltdoc="x">Notes</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Intro.html" class="tocviewlink" data-pltdoc="x">What <span class="emph">is</span> a Compiler?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="OCaml_to_Racket.html" class="tocviewlink" data-pltdoc="x">From OCaml to Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="a86.html" class="tocviewlink" data-pltdoc="x">a86:<span class="mywbr"> &nbsp;</span> a Little Assembly Language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Abscond:<span class="mywbr"> &nbsp;</span> a language of numbers</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Blackmail.html" class="tocviewlink" data-pltdoc="x">Blackmail:<span class="mywbr"> &nbsp;</span> incrementing and decrementing</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Con.html" class="tocviewlink" data-pltdoc="x">Con:<span class="mywbr"> &nbsp;</span> branching with conditionals</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Dupe.html" class="tocviewlink" data-pltdoc="x">Dupe:<span class="mywbr"> &nbsp;</span> a duplicity of types</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Dodger.html" class="tocviewlink" data-pltdoc="x">Dodger:<span class="mywbr"> &nbsp;</span> addressing a lack of character</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Evildoer.html" class="tocviewlink" data-pltdoc="x">Evildoer:<span class="mywbr"> &nbsp;</span> change the world a couple nibbles at a time</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Extort.html" class="tocviewlink" data-pltdoc="x">Extort:<span class="mywbr"> &nbsp;</span> when errors exist</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Fraud.html" class="tocviewlink" data-pltdoc="x">Fraud:<span class="mywbr"> &nbsp;</span> local binding, variables, and binary operations</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Hustle.html" class="tocviewlink" data-pltdoc="x">Hustle:<span class="mywbr"> &nbsp;</span> heaps and lists</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="Hoax.html" class="tocviewlink" data-pltdoc="x">Hoax:<span class="mywbr"> &nbsp;</span> vectors and strings</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="Iniquity.html" class="tocviewlink" data-pltdoc="x">Iniquity:<span class="mywbr"> &nbsp;</span> function definitions and calls</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="Jig.html" class="tocviewlink" data-pltdoc="x">Jig:<span class="mywbr"> &nbsp;</span> jumping to tail calls</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="Knock.html" class="tocviewlink" data-pltdoc="x">Knock:<span class="mywbr"> &nbsp;</span> pattern matching</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="Loot.html" class="tocviewlink" data-pltdoc="x">Loot:<span class="mywbr"> &nbsp;</span> lambda the ultimate</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="Mug.html" class="tocviewlink" data-pltdoc="x">Mug:<span class="mywbr"> &nbsp;</span> symbols and interned string literals</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="Mountebank.html" class="tocviewlink" data-pltdoc="x">Mountebank:<span class="mywbr"> &nbsp;</span> quote and compound static data</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="Neerdowell.html" class="tocviewlink" data-pltdoc="x">Neerdowell:<span class="mywbr"> &nbsp;</span> structures</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="Outlaw.html" class="tocviewlink" data-pltdoc="x">Outlaw:<span class="mywbr"> &nbsp;</span> self-<wbr></wbr>hosting</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Abscond:<span class="mywbr"> &nbsp;</span> a language of numbers</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="#%28part._.Overview%29" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">4.2&nbsp;</td><td><a href="#%28part._.Concrete_syntax_for_.Abscond%29" class="tocviewlink" data-pltdoc="x">Concrete syntax for Abscond</a></td></tr><tr><td align="right">4.3&nbsp;</td><td><a href="#%28part._.Abstract_syntax_for_.Abscond%29" class="tocviewlink" data-pltdoc="x">Abstract syntax for Abscond</a></td></tr><tr><td align="right">4.4&nbsp;</td><td><a href="#%28part._.Meaning_of_.Abscond_programs%29" class="tocviewlink" data-pltdoc="x">Meaning of Abscond programs</a></td></tr><tr><td align="right">4.5&nbsp;</td><td><a href="#%28part._.Toward_a_.Compiler_for_.Abscond%29" class="tocviewlink" data-pltdoc="x">Toward a Compiler for Abscond</a></td></tr><tr><td align="right">4.6&nbsp;</td><td><a href="#%28part._.An_.Example%29" class="tocviewlink" data-pltdoc="x">An Example</a></td></tr><tr><td align="right">4.7&nbsp;</td><td><a href="#%28part._.A_.Compiler_for_.Abscond%29" class="tocviewlink" data-pltdoc="x">A Compiler for Abscond</a></td></tr><tr><td align="right">4.8&nbsp;</td><td><a href="#%28part._.But_is_it_.Correct_%29" class="tocviewlink" data-pltdoc="x">But is it <span class="emph">Correct</span>?</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Overview%29" class="tocsubseclink" data-pltdoc="x">Overview</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Concrete_syntax_for_.Abscond%29" class="tocsubseclink" data-pltdoc="x">Concrete syntax for Abscond</a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.Abstract_syntax_for_.Abscond%29" class="tocsubseclink" data-pltdoc="x">Abstract syntax for Abscond</a></td></tr><tr><td><span class="tocsublinknumber">4.4<tt>&nbsp;</tt></span><a href="#%28part._.Meaning_of_.Abscond_programs%29" class="tocsubseclink" data-pltdoc="x">Meaning of Abscond programs</a></td></tr><tr><td><span class="tocsublinknumber">4.5<tt>&nbsp;</tt></span><a href="#%28part._.Toward_a_.Compiler_for_.Abscond%29" class="tocsubseclink" data-pltdoc="x">Toward a Compiler for Abscond</a></td></tr><tr><td><span class="tocsublinknumber">4.6<tt>&nbsp;</tt></span><a href="#%28part._.An_.Example%29" class="tocsubseclink" data-pltdoc="x">An Example</a></td></tr><tr><td><span class="tocsublinknumber">4.7<tt>&nbsp;</tt></span><a href="#%28part._.A_.Compiler_for_.Abscond%29" class="tocsubseclink" data-pltdoc="x">A Compiler for Abscond</a></td></tr><tr><td><span class="tocsublinknumber">4.8<tt>&nbsp;</tt></span><a href="#%28part._.But_is_it_.Correct_%29" class="tocsubseclink" data-pltdoc="x">But is it <span class="emph">Correct</span>?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.15</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="a86.html" title="backward to &quot;3 a86: a Little Assembly Language&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Notes.html" title="up to &quot;Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Blackmail.html" title="forward to &quot;5 Blackmail: incrementing and decrementing&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h4 class="heading">4<tt>&nbsp;</tt><a name="(part._.Abscond)"></a>Abscond: a language of numbers<span class="button-group"><a href="#(part._.Abscond)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h4><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><img src="pict.png" alt="image" width="37.0" height="24.0"/> <a href="code/abscond.zip">Source code</a>.</p></blockquote></blockquote></blockquote><p><span class="emph">Let&rsquo;s Make a Programming Language!</span></p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Overview%29" class="toclink" data-pltdoc="x">4.1<span class="hspace">&nbsp;</span>Overview</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Concrete_syntax_for_.Abscond%29" class="toclink" data-pltdoc="x">4.2<span class="hspace">&nbsp;</span>Concrete syntax for Abscond</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Abstract_syntax_for_.Abscond%29" class="toclink" data-pltdoc="x">4.3<span class="hspace">&nbsp;</span>Abstract syntax for Abscond</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Meaning_of_.Abscond_programs%29" class="toclink" data-pltdoc="x">4.4<span class="hspace">&nbsp;</span>Meaning of Abscond programs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Toward_a_.Compiler_for_.Abscond%29" class="toclink" data-pltdoc="x">4.5<span class="hspace">&nbsp;</span>Toward a Compiler for Abscond</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.An_.Example%29" class="toclink" data-pltdoc="x">4.6<span class="hspace">&nbsp;</span>An Example</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.A_.Compiler_for_.Abscond%29" class="toclink" data-pltdoc="x">4.7<span class="hspace">&nbsp;</span>A Compiler for Abscond</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.But_is_it_.Correct_%29" class="toclink" data-pltdoc="x">4.8<span class="hspace">&nbsp;</span>But is it <span class="emph">Correct</span>?</a></p></td></tr></table><h5 class="heading">4.1<tt>&nbsp;</tt><a name="(part._.Overview)"></a>Overview<span class="button-group"><a href="#(part._.Overview)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>A compiler is just one (optional!) component of a <span class="emph">programming
language</span>.  So if you want to make a compiler, you must first settle
on a programming language to compile.</p><p>The specification of a programming language consists of two parts: the
syntax, which specifies the <span style="font-weight: bold">form</span> of programs, and semantics,
which specifies the <span style="font-weight: bold">meaning</span> of programs.</p><p>Syntax, while important, is a fairly superficial aspect of
programming languages. The real heart of a programming
language is its semantics and we will spend more time
concerned this aspect.</p><p>There are a few common ways a language&rsquo;s meaning is specified:</p><ul><li><p>By example.</p></li><li><p>By informal description.</p></li><li><p>By reference to an implementation, often an interpreter.</p></li><li><p>By formal (mathematical) definition.</p></li></ul><p>Each approach has its advantages and disadvantages.  Examples are
concise and unambiguous, but incomplete.  Informal (prose)
descriptions can be intuitive, but open to interpretation and
ambiguity.  Reference implementations provide precise, executable
specifications, but may over specify language details by tying them to
implementation artifacts.  Formal definitions balance precision while
allowing for under-specification, but require detailed definitions and
training to understand.</p><p>We will use a combination of each.</p><p>To begin, let&rsquo;s start with a dead simple programming language called
<span style="font-weight: bold">Abscond</span>.  The only kind of expression in Abscond are integer
literals.  Running an abscond program just produces that integer.
(Told you it was simple.)</p><h5 class="heading">4.2<tt>&nbsp;</tt><a name="(part._.Concrete_syntax_for_.Abscond)"></a>Concrete syntax for Abscond<span class="button-group"><a href="#(part._.Concrete_syntax_for_.Abscond)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>We will simplify matters of syntax by using the Lisp
notation of s-expression for the <span style="font-weight: bold">concrete</span> form of
program phrases. The job of a <span class="emph">parser</span> is to construct
an abstract syntax tree from the textual representation of a
program. We will consider parsing in two phases:</p><ul><li><p>the first converts a stream of textual input into an
s-expression, and</p></li><li><p>the second converts an s-expression into an instance
of a datatype for representing expressions called an <span style="font-weight: bold">AST</span>.</p></li></ul><p>For the first phase, we rely on the <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29" class="RktValLink" data-pltdoc="x">read</a></span> function
to take care of converting strings to s-expressions. In
order to parse s-expressions into ASTs, we will write fairly
straightforward functions that convert between the
representations.</p><p>Abscond, like the other languages studied in this course, is
designed to be a subset of Racket. This has two primary benefits:</p><ul><li><p>the Racket interpreter and compiler can be used as a reference implementation of the languages we build, and</p></li><li><p>there are built-in facilities for reading and writing
data in the parenthezised form that Racket uses, which we can borrow to make parsing easy.</p></li></ul><p>The concrete form of an Abscond program will consist of, like Racket, the line of text:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang racket</span></p></td></tr></table></p><p>followed by a (concrete) expression.  The grammar of expressions is
very simple:</p><blockquote class="SCentered"><p><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_2.png" alt="image" width="74.5439453125" height="20.0"/></p></blockquote><p>So, <span class="RktVal">0</span>, <span class="RktVal">120</span>, <span class="RktVal"><span class="nobreak">-4</span>2</span>, etc. are
concrete Abscond expressions and a complete Abscond program
looks like this:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/42.rkt"><span class="stt">abscond/42.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">42</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p>Reading Abscond programs from ports, files, strings,
etc. consists of reading (and ignoring) the
<span class="stt">#lang racket</span>
line and then using the <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29" class="RktValLink" data-pltdoc="x">read</a></span> function to
parse the concrete expression as an s-expression.</p><h5 class="heading">4.3<tt>&nbsp;</tt><a name="(part._.Abstract_syntax_for_.Abscond)"></a>Abstract syntax for Abscond<span class="button-group"><a href="#(part._.Abstract_syntax_for_.Abscond)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>While not terribly useful for a language as overly simplistic as Abscond, we use
an AST datatype for representing expressions and another syntactic categories.
For each category, we will have an appropriate constructor.  In the case of Abscond
all expressions are integers, so we have a single constructor, <span class="RktSym">Lit</span>.</p><blockquote class="SCentered"><p><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_3.png" alt="image" width="74.5439453125" height="34.2802734375"/></p></blockquote><p>A datatype for representing expressions can be defined as:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/ast.rkt"><span class="stt">abscond/ast.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Lit</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">type</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">=</span><span class="hspace">&nbsp;</span><span class="RktCmt">(Lit</span><span class="hspace">&nbsp;</span><span class="RktCmt">Integer)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:prefab</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p><div class="SIntrapara">The parser for Abscond checks that a given s-expression is
an integer and constructs an instance of the AST datatype if
it is, otherwise it signals an error:
</div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/parse.rkt"><span class="stt">abscond/parse.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">parse</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"ast.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">S-Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-integer?</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"parse</span><span class="hspace">&nbsp;</span><span class="RktVal">error"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote></div></p><h5 class="heading">4.4<tt>&nbsp;</tt><a name="(part._.Meaning_of_.Abscond_programs)"></a>Meaning of Abscond programs<span class="button-group"><a href="#(part._.Meaning_of_.Abscond_programs)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>The meaning of an Abscond program is simply the number itself.  So
<span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal">42</span><span class="RktPn">)</span> evaluates to <span class="RktVal">42</span>.</p><p>We can write an &ldquo;interpreter&rdquo; that consumes an expression and
produces it&rsquo;s meaning:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/interp.rkt"><span class="stt">abscond/interp.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">interp</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"ast.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Integer</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-8</span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-8</span></p></td></tr></table></blockquote></div></p><p>We can add a command line wrapper program for interpreting Abscond
programs from stdin:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/interp-stdin.rkt"><span class="stt">abscond/interp-stdin.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"parse.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"interp.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Void</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Parse</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">interpret</span><span class="hspace">&nbsp;</span><span class="RktCmt">contents</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">stdin,</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">print</span><span class="hspace">&nbsp;</span><span class="RktCmt">result</span><span class="hspace">&nbsp;</span><span class="RktCmt">on</span><span class="hspace">&nbsp;</span><span class="RktCmt">stdout</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#%28def._%28%28quote._~23~25kernel%29._read-line%29%29" class="RktValLink" data-pltdoc="x">read-line</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">ignore</span><span class="hspace">&nbsp;</span><span class="RktCmt">#lang</span><span class="hspace">&nbsp;</span><span class="RktCmt">racket</span><span class="hspace">&nbsp;</span><span class="RktCmt">line</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Writing.html#%28def._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._println%29%29" class="RktValLink" data-pltdoc="x">println</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29" class="RktValLink" data-pltdoc="x">read</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p>The details here aren&rsquo;t important (and you won&rsquo;t be asked to write
this kind of code), but this program <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29" class="RktValLink" data-pltdoc="x">read</a></span>s the contents of a
file given on the command line.  If it&rsquo;s an integer, i.e. a
well-formed Abscond program, then it runs the intepreter and displays
the result.</p><p><div class="SIntrapara">For example, interpreting the program <span class="stt">42.rkt</span> shown above:
</div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> cat 42.rkt | racket -t interp-stdin.rkt -m</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>42</span></code></pre></div>
</p></blockquote></blockquote></div></p><p>Even though the semantics is obvious, we can provide a formal
definition of Abscond using <span style="font-weight: bold">operational semantics</span>.</p><p>An operational semantics is a mathematical definition that
characterizes the meaning of programs.  We will defined the semantics
of Abscond as a <span class="emph">binary relation</span> between programs and their
meanings.  So in the setting of Abscond, this binary relation will be
a set of pairs of expressions and integers.  This relation will be
defined inductively using <span class="emph">inference rules</span>.  For such a simple
language, just a single inference rule suffices:</p><blockquote class="SCentered"><p><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_4.png" alt="image" width="68.5693359375" height="29.2802734375"/></p></blockquote><p>Here, we are defining a binary relation, called
<img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_5.png" alt="image" width="15.92578125" height="20.0"/>, and saying every integer literal
expression is paired with the integer itself in the
relation. So <span style="font-style: italic"></span>(<span style="font-style: italic"></span>(<span style="font-style: italic">Lit </span>2<span style="font-style: italic"></span>)<span style="font-style: italic">,</span>2<span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_6.png" alt="image" width="15.92578125" height="20.0"/>,
<span style="font-style: italic"></span>(<span style="font-style: italic"></span>(<span style="font-style: italic">Lit </span>5<span style="font-style: italic"></span>)<span style="font-style: italic">,</span>5<span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_7.png" alt="image" width="15.92578125" height="20.0"/>, and so on.</p><p>The inference rules define the binary relation by defining the
<span class="emph">evidence</span> for being in the relation.  The rule makes use of
<span class="emph">meta-variables</span> drawn from the non-terminals of the language
grammar.  A pair is in the relation if you can construct an instance
of the rule (substituting some integer for <span style="font-style: italic">i</span>) in the rule.</p><p>(This part probably seems opaque at the moment, but it will become
clearer as we work through more examples, so don&rsquo;t worry.)</p><p>The operational semantics <span class="emph">defines</span> the meaning of Abscond
programs.  The intepreter <span class="emph">computes</span> that meaning.  We can view
the semantics as a specification, and the interpreter as an
implementation.</p><p>Characterizing the correctness of the interpreter boils down to the
following statement:</p><p><span style="font-weight: bold">Interpreter Correctness</span>: <span class="emph">For all expressions <span class="RktSym">e</span>
and integers <span class="RktSym">i</span>, if (<span class="RktSym">e</span>,<span class="RktSym">i</span>) in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_8.png" alt="image" width="15.92578125" height="20.0"/>, then <span class="RktPn">(</span><span class="RktSym">interp</span><span class="stt"> </span><span class="RktSym">e</span><span class="RktPn">)</span> equals <span class="RktSym">i</span>.</span></p><p>We now have a complete (if overly simple) programming language with an
operational semantics and an interpreter, which is (obviously)
correct.  Now let&rsquo;s write a compiler.</p><h5 class="heading">4.5<tt>&nbsp;</tt><a name="(part._.Toward_a_.Compiler_for_.Abscond)"></a>Toward a Compiler for Abscond<span class="button-group"><a href="#(part._.Toward_a_.Compiler_for_.Abscond)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>A compiler, like an interpreter, is an implementation of a programming
language.  The key difference is that a compiler stages the work of
interpreting a program into two phases.  The first translates the
original program (the source language) into a program in another
programming language (the target language).  The second runs this
program.  These phases, often called <span style="font-weight: bold">compile-time</span> and
<span style="font-weight: bold">run-time</span>.  The program that does the translation is the
<span style="font-weight: bold">compiler</span>.  The program that does the running of the translated
program is the <span style="font-weight: bold">run-time system</span>.</p><p>So in general, the relationship between an interpreter and compiler is</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">(source-interp e) = (target-interp (source-compile e))</span></p></td></tr></table></p><p>We can in principle choose any target language we&rsquo;d like.  For this
class, we will choose the <span style="font-weight: bold">x86-64</span> instruction set architecture.</p><p>There are several reasons for this choice:</p><ul><li><p>it is a low-level language, so compiling from a high-level
language to x86-64 will require building everything from scratch,</p></li><li><p>it is the programming language at the &ldquo;bottom&rdquo; of your
computer; it&rsquo;s interpreter is implemented in hardware on your
computer&rsquo;s CPU,</p></li><li><p>it is one of the two dominant computing architectures (the other
being ARM), and</p></li><li><p>it is a mature technology with good tools and materials.</p></li></ul><p>So our compiler will emit x86 assembly code.  To make our lives a bit
easier, we will write the run-time system in C.  Let&rsquo;s start with the
Abscond runtime:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/main.c"><span class="stt">main.c</span></a></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;inttypes.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;print.h&quot;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int64_t</span> entry<span class="op">();</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span><span class="op">**</span> argv<span class="op">)</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int64_t</span> result<span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  result <span class="op">=</span> entry<span class="op">();</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  print_result<span class="op">(</span>result<span class="op">);</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  putchar<span class="op">(</span><span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">);</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</p></blockquote></blockquote><p>This C program provides the main entry point for running an Abscond
program.  It relies upon a function <span class="stt">print_result</span> which is defined
as follows:</p><p><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/print.h"><span class="stt">print.h</span></a></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef PRINT_H</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRINT_H</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_result<span class="op">(</span><span class="dt">int64_t</span><span class="op">);</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
</p></blockquote></blockquote></div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/print.c"><span class="stt">print.c</span></a></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;inttypes.h&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_result<span class="op">(</span><span class="dt">int64_t</span> x<span class="op">)</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  printf<span class="op">(</span><span class="st">&quot;%&quot;</span> PRId64<span class="op">,</span> x<span class="op">);</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</p></blockquote></blockquote></div></p><p>Separating out <span class="stt">print_result</span>, which at this point is just a simple
<span class="stt">printf</span> statement, seems like overkill, but it will be useful in
the future as the language gets more complicated.</p><p>The runtime must be linked against an object file that provides the
definition of <span class="stt">entry</span>; this is the code our compiler will emit.</p><p>The <span class="stt">entry</span> function computes the result of running the
Abscond code, i.e. an integer.  Here we are taking advantage of the
x86-64 architecture by using 64-bit signed integers by using the
<span class="stt">int64_t</span> C type.</p><p>The runtime system calls the function and prints the result.</p><p>We can compile the run-time system to get an object file.  We&rsquo;ll use
<span class="stt">gcc</span> for compiling C:</p><p><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> gcc -m64 -c -o main.o main.c</span></code></pre></div>
</p></blockquote></blockquote></div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> gcc -m64 -c -o print.o print.c</span></code></pre></div>
</p></blockquote></blockquote></div></p><p>This creates <span class="stt">main.o</span> and <span class="stt">print.o</span>; linking these file together
with an object file that contains <span class="stt">entry</span> will produce an
executable that, when run, will carry out the execution of an Abscond
program.</p><h5 class="heading">4.6<tt>&nbsp;</tt><a name="(part._.An_.Example)"></a>An Example<span class="button-group"><a href="#(part._.An_.Example)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Before trying to write the Abscond compiler, let&rsquo;s first make an
example of what we would like the compiler to produce for a particular
example.  Let&rsquo;s say the Abscond program is <span class="RktVal">42</span>.  What should
the assembly code for this program look like?  Here we have to learn a
bit about the x86-64 assembly language.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/42.s"><span class="stt">42.s</span></a></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode nasm"><code class="sourceCode nasm"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>        default rel</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">section</span> .text</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> <span class="dv">$</span>_entry</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">$_entry:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">mov</span> rax, <span class="dv">42</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ret</span></span></code></pre></div>
</p></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note: on macOS, labels must be prepended with <span class="stt">_</span>,
while on Linux they are not; e.g. <span class="stt">_entry</span> vs <span class="stt">entry</span>.</p></blockquote></blockquote></blockquote><p>Above is a x86-64 program, written in NASM syntax.  We will be using
<span class="stt">nasm</span> as our assembler in this class because it is widely used and
available on most platforms.</p><ul><li><p>The first line declares a global label (<span class="stt">entry</span>), an
entry point in to the code below.</p></li><li><p>The next line declares the start of a section of code consisting
of textual instructions.</p></li><li><p>The third line contains the <span class="stt">entry</span> label, i.e. the start of
the <span class="stt">entry</span> code.  When the run-time systems calls <span class="stt">entry</span>, it
will jump to this point in the code.</p></li><li><p>The fourth line is an instruction to move the integer literal 42
into the <span class="stt">rax</span> register.  By convention, whatever is in the
<span class="stt">rax</span> register when code returns control to the caller will hold
the return value.</p></li><li><p>The final line is an instruction to return control to the
caller.</p></li></ul><p>To assemble this program into an object file, we can run the <span class="stt">nasm</span>
assembler:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> nasm -f macho64 -o 42.o 42.s</span></code></pre></div>
</p></blockquote></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note: on macOS, the format option <span class="stt">-f</span> should be
<span class="stt">macho64</span>; on Linux it should be <span class="stt">elf64</span>.</p></blockquote></blockquote></blockquote><p>This creates <span class="stt">42.o</span>, an object file containing the instructions
above (in binary format).</p><p>We can link this file with the run-time to produce an executable file:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> gcc main.o print.o 42.o -o 42.run</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ld:</span> warning: no platform load command found in &#39;<span class="st">/Users/anwar/Library/Racket/8.15/pkgs/langs/abscond/42.o&#39;</span>, assuming: macOS</span></code></pre></div>
</p></blockquote></blockquote><p>This creates the file <span class="stt">42.run</span>, an exectuable program:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ./42.run</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>42</span></code></pre></div>
</p></blockquote></blockquote><p>We now have a working example.  The remaining work will be to design a
compiler that takes an Abscond program and emits a file like
<span class="stt">42.s</span>, but with the appropriate integer literal.</p><h5 class="heading">4.7<tt>&nbsp;</tt><a name="(part._.A_.Compiler_for_.Abscond)"></a>A Compiler for Abscond<span class="button-group"><a href="#(part._.A_.Compiler_for_.Abscond)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>We will now write a compiler for Abscond.  To heart of the compiler
will be a function with the following signature:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Expr -&gt; Asm</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29._......%29%29" class="RktStxLink" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></table></blockquote><p>Where <span class="stt">Asm</span> is a data type for representing assembly programs,
i.e. it will be the AST of x86-64 assembly.</p><p>So the AST representation of our example is:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Label%29%29" class="RktValLink" data-pltdoc="x">Label</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">entry</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Mov%29%29" class="RktValLink" data-pltdoc="x">Mov</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">rax</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Ret%29%29" class="RktValLink" data-pltdoc="x">Ret</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Writing the <span class="RktSym">compile</span> function is easy:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/compile.rkt"><span class="stt">abscond/compile.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile-e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"ast.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a86/ast</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="../../../../../Library/Racket/8.15/pkgs/a86/a86/doc/a86/index.html#%28def._%28%28lib._a86%2Fregisters..rkt%29._rax%29%29" class="RktValLink" data-pltdoc="x">rax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym"><a href="../../../../../Library/Racket/8.15/pkgs/a86/a86/doc/a86/index.html#%28def._%28%28lib._a86%2Fregisters..rkt%29._rax%29%29" class="RktValLink" data-pltdoc="x">rax</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Asm</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._prog%29%29" class="RktValLink" data-pltdoc="x">prog</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Global%29%29" class="RktValLink" data-pltdoc="x">Global</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym">entry</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Label%29%29" class="RktValLink" data-pltdoc="x">Label</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym">entry</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-e</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Ret%29%29" class="RktValLink" data-pltdoc="x">Ret</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Asm</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-e</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._seq%29%29" class="RktValLink" data-pltdoc="x">seq</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Mov%29%29" class="RktValLink" data-pltdoc="x">Mov</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="../../../../../Library/Racket/8.15/pkgs/a86/a86/doc/a86/index.html#%28def._%28%28lib._a86%2Fregisters..rkt%29._rax%29%29" class="RktValLink" data-pltdoc="x">rax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Global 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Label 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Mov 'rax 42)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Ret))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">38</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Global 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Label 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Mov 'rax 38)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Ret))</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>To convert back to the concrete NASM syntax, we use
<span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fprinter..rkt%29._asm-display%29%29" class="RktValLink" data-pltdoc="x">asm-display</a></span>.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note: the printer takes care of the macOS vs Linux label
convention by detecting the underlying system and printing
appropriately.</p></blockquote></blockquote></blockquote><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fprinter..rkt%29._asm-display%29%29" class="RktValLink" data-pltdoc="x">asm-display</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">default rel</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">section .text</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">global $_entry</span></p></td></tr><tr><td><p><span class="RktOut">$_entry:</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">mov rax, 42</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">ret</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>Putting it all together, we can write a command line compiler much
like the command line interpreter before, except now we emit assembly
code:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/abscond/compile-stdin.rkt"><span class="stt">abscond/compile-stdin.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"parse.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"compile.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a86/printer</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Void</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Compile</span><span class="hspace">&nbsp;</span><span class="RktCmt">contents</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">stdin,</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">emit</span><span class="hspace">&nbsp;</span><span class="RktCmt">asm</span><span class="hspace">&nbsp;</span><span class="RktCmt">code</span><span class="hspace">&nbsp;</span><span class="RktCmt">on</span><span class="hspace">&nbsp;</span><span class="RktCmt">stdout</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">main</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Byte_and_String_Input.html#%28def._%28%28quote._~23~25kernel%29._read-line%29%29" class="RktValLink" data-pltdoc="x">read-line</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;</span><span class="hspace">&nbsp;</span><span class="RktCmt">ignore</span><span class="hspace">&nbsp;</span><span class="RktCmt">#lang</span><span class="hspace">&nbsp;</span><span class="RktCmt">racket</span><span class="hspace">&nbsp;</span><span class="RktCmt">line</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fprinter..rkt%29._asm-display%29%29" class="RktValLink" data-pltdoc="x">asm-display</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29" class="RktValLink" data-pltdoc="x">read</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p>Example:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> cat 42.rkt | racket -t compile-stdin.rkt -m</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">default</span> rel</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">section</span> .text</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">global</span> <span class="va">$_entry</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>$<span class="fu">_entry:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mov</span> rax, 42</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ret</span></span></code></pre></div>
</p></blockquote></blockquote><p>Using a Makefile, we can capture the whole compilation dependencies as:</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note: the appropriate object file format is detected
based on the operating system.</p></blockquote></blockquote></blockquote><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/Makefile"><span class="stt">Makefile</span></a></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode makefile"><code class="sourceCode makefile"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">UNAME</span> <span class="ch">:=</span><span class="st"> </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> uname</span><span class="ch">)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">ifeq</span> (<span class="ch">$(</span><span class="dt">UNAME</span><span class="ch">)</span>, Darwin)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="ch">=</span><span class="st">macho64</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CC</span><span class="ch">=</span><span class="st">arch -x86_64 gcc</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="ch">=</span><span class="st">elf64</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">CC</span><span class="ch">=</span><span class="st">gcc</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="cf">endif</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dt">objs</span> <span class="ch">=</span><span class="st"> </span><span class="ch">\</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="st">    main.o </span><span class="ch">\</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="st">    print.o</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dv">default:</span><span class="dt"> submit.zip</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="dv">submit.zip:</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>zip submit.zip -r * \</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="ch">-</span><span class="fu">x \*.[os] -x \*~ -x \*zip </span><span class="ch">\</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">        -x \*Zone.Identifier -x \*\*compiled\*\*</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="dv">runtime.o:</span><span class="dt"> </span><span class="ch">$(</span><span class="dt">objs</span><span class="ch">)</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>ld -r <span class="ch">$(</span><span class="dt">objs</span><span class="ch">)</span> -o runtime.o</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="dv">%.run:</span><span class="dt"> %.o runtime.o</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> runtime.o <span class="ch">$&lt;</span> -o <span class="ch">$@</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="ot">.c.o:</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">$(</span><span class="dt">CC</span><span class="ch">)</span> -fPIC -c -g -o <span class="ch">$@</span> <span class="ch">$&lt;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="ot">.s.o:</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>nasm -g -f <span class="ch">$(</span><span class="dt">format</span><span class="ch">)</span> -o <span class="ch">$@</span> <span class="ch">$&lt;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="dv">%.s:</span><span class="dt"> %.rkt</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="er">    </span>cat <span class="ch">$&lt;</span> | racket -t compile-stdin.rkt -m &gt; <span class="ch">$@</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="dv">clean:</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@$(</span><span class="dt">RM</span><span class="ch">)</span><span class="fu"> *.o *.s *.run ||:</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="ch">@</span><span class="fu">echo </span><span class="st">&quot;</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> basename </span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> pwd</span><span class="ch">))</span><span class="st">: cleaned!&quot;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="dv">%.test:</span><span class="dt"> %.run %.rkt</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="er">    </span><span class="ch">@</span><span class="fu">test </span><span class="st">&quot;</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> ./</span><span class="ch">$(</span><span class="dt">&lt;</span><span class="ch">))</span><span class="st">&quot;</span><span class="fu"> = </span><span class="st">&quot;</span><span class="ch">$(</span><span class="kw">shell</span><span class="st"> racket </span><span class="ch">$(</span><span class="kw">word</span><span class="st"> 2</span><span class="kw">,</span><span class="ch">$^))</span><span class="st">&quot;</span></span></code></pre></div>
</p></blockquote></blockquote><p>And now compiling Abscond programs is easy-peasy:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> make 42.run</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ld</span> -r main.o print.o -o runtime.o</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arch</span> -x86_64 gcc runtime.o 42.o -o 42.run</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ld:</span> warning: no platform load command found in &#39;<span class="st">/Users/anwar/Library/Racket/8.15/pkgs/langs/abscond/42.o&#39;</span>, assuming: macOS</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ./42.run</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>42</span></code></pre></div>
</p></blockquote></blockquote><p>It&rsquo;s worth taking stock of what we have at this point, compared to the
interpreter approach.  To run the interpreter requires all of Racket
in the run-time system.</p><p>When running a program using the interpreter, we have to parse the
Abscond program, check the syntax of the program (making sure it&rsquo;s an
integer), then run the interpreter and print the result.</p><p>When running a program using the compiler, we still have to parse the
Abscond program and check its syntax, but this work happens <span class="emph">at
compile-time</span>.  When we <span class="emph">run</span> the program this work will have
already been done.  While the compiler needs Racket to run, at
run-time, Racket does not need to be available.  All the run-time
needs is our (very tiny) object file compiled from C.  Racket doesn&rsquo;t
run at all &ndash; we could delete it from our computer or ship the
executable to any compatible x86-64 machine and run it there.  This
adds up to much more efficient programs.  Just to demonstrate, here&rsquo;s
a single data point measuring the difference between interpreting and
compiling Abscond programs:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> cat 42.rkt | time -p racket -t interp-stdin.rkt -m</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>42</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> 0.64</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">user</span> 0.52</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sys</span> 0.11</span></code></pre></div>
</p></blockquote></blockquote><p>Compiling:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> time -p ./42.run</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>42</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> 0.00</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">user</span> 0.00</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sys</span> 0.00</span></code></pre></div>
</p></blockquote></blockquote><p>Because Abscond is a subset of Racket, we can even compare results
against interpreting the program directly in Racket:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> touch 42.rkt <span class="co"># forces interpreter to be used</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> time -p racket 42.rkt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>42</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> 0.70</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">user</span> 0.57</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sys</span> 0.11</span></code></pre></div>
</p></blockquote></blockquote><p>Moreover, we can compare our compiled code to code compiled by Racket:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> raco make 42.rkt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> time -p racket 42.rkt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>42</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">real</span> 0.51</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">user</span> 0.41</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sys</span> 0.09</span></code></pre></div>
</p></blockquote></blockquote><h5 class="heading">4.8<tt>&nbsp;</tt><a name="(part._.But_is_it_.Correct_)"></a>But is it <span class="emph">Correct</span>?<span class="button-group"><a href="#(part._.But_is_it_.Correct_)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>At this point, we have a compiler for Abscond.  But is it correct?</p><p>Here is a statement of compiler correctness:</p><p><span style="font-weight: bold">Compiler Correctness</span>: <span class="emph">For all expressions <span class="RktSym">e</span> and
integers <span class="RktSym">i</span>, if (<span class="RktSym">e</span>,<span class="RktSym">i</span>) in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_9.png" alt="image" width="15.92578125" height="20.0"/>, then <span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="stt"> </span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span> equals
<span class="RktSym">i</span>.</span></p><p>Ultimately, we want the compiler to capture the operational semantics
of our language (the ground truth of what programs mean).  However,
from a practical stand-point, relating the compiler to the intepreter
may be more straightforward.  What&rsquo;s nice about the interpreter is we
can run it, so we can <span class="emph">test</span> the compiler against the
interpreter.  Moreover, since we claimed the interpreter is correct
(w.r.t. to the semantics), testing the compiler against the interpreter
is a way of testing it against the semantics, indirectly.  If the
compiler and interpreter agree on all possible inputs, then the
compiler is correct with respect to the semantics since it is
equivalent to the interpreter, and the interpreter is correct.</p><p>So, in this setting, means we have the following equivaluence:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">(interp e) </span><span class="emph">equals</span><span class="stt"></span><span class="hspace">&nbsp;</span><span class="stt">(asm-interp (compile e))</span></p></td></tr></table></p><p>But we don&rsquo;t actually have <span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span>, a function that
interprets the Asm code we generate.  Instead we printed the code and
had <span class="stt">gcc</span> assembly and link it into an executable, which the OS
could run.  But this is a minor distinction.  We can use
<span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span> to interact with the OS to do all of these steps.</p><p>This is actually a handy tool to have for experimenting with
compilation within Racket:</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">37</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">37</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-8</span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-8</span></p></td></tr></table></blockquote></div></p><p>This of course agrees with what we will get from the interpreter:</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">37</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">37</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-8</span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-8</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">We can turn this in a <span style="font-weight: bold">property-based test</span>, i.e. a function that
computes a test expressing a single instance of our compiler
correctness claim:
</div><div class="SIntrapara"><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-eqv?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">37</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-8</span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p></div></p><p>This is a powerful testing technique when combined with random
generation.  Since our correctness claim should hold for <span class="emph">all</span>
Abscond programs, we can randomly generate <span class="emph">any</span> Abscond program
and check that it holds.</p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._random%29%29" class="RktValLink" data-pltdoc="x">random</a></span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%29%29" class="RktStxLink" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-range%29%29" class="RktValLink" data-pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._random%29%29" class="RktValLink" data-pltdoc="x">random</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10000</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>The last expression is taking 10 samples from the space of Abscond
programs in <span style="font-style: italic"></span>[<span style="font-style: italic"></span>0<span style="font-style: italic">,</span>1<span style="font-style: italic"></span>0<span style="font-style: italic"></span>0<span style="font-style: italic"></span>0<span style="font-style: italic"></span>0<span style="font-style: italic"></span>)<span style="font-style: italic"></span> and checking the compiler correctness
claim on them.  If the claim doesn&rsquo;t hold for any of these samples, a
test failure would be reported.</p><p>Finding an input to <span class="RktSym">check-compiler</span> that fails would
<span class="emph">refute</span> the compiler correctness claim and mean that we have a
bug.  Such an input is called a <span style="font-weight: bold">counter-example</span>.</p><p>On the other hand we gain more confidence with each passing test.
While passing tests increase our confidence, we cannot test all
possible inputs this way, so we can&rsquo;t be sure our compiler is correct
by testing alone.  To really be sure, we&rsquo;d need to write a
<span class="emph">proof</span>, but that&rsquo;s beyond the scope of this class.</p><p>At this point we have not found a counter-example to compiler
correctness.  It&rsquo;s tempting to declare victory.  But... can you think
of a valid input (i.e. some integer) that might refute the correctness
claim?</p><p>Think on it.  In the meantime, let&rsquo;s move on.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="a86.html" title="backward to &quot;3 a86: a Little Assembly Language&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Notes.html" title="up to &quot;Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Blackmail.html" title="forward to &quot;5 Blackmail: incrementing and decrementing&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>