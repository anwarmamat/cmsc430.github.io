<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>5&nbsp;Blackmail: incrementing and decrementing</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="extra.css" title="default"/><link rel="stylesheet" type="text/css" href="fancyverb.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="accessibility.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">CMSC 430:<span class="mywbr"> &nbsp;</span> Design and Implementation of Programming Languages</a></td></tr></table></div><div class="tocviewsublisttop" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right"></td><td><a href="Syllabus.html" class="tocviewlink" data-pltdoc="x">Syllabus</a></td></tr><tr><td align="right"></td><td><a href="Texts.html" class="tocviewlink" data-pltdoc="x">Texts</a></td></tr><tr><td align="right"></td><td><a href="Schedule.html" class="tocviewlink" data-pltdoc="x">Schedule</a></td></tr><tr><td align="right"></td><td><a href="Notes.html" class="tocviewselflink" data-pltdoc="x">Notes</a></td></tr><tr><td align="right"></td><td><a href="Assignments.html" class="tocviewlink" data-pltdoc="x">Assignments</a></td></tr><tr><td align="right"></td><td><a href="Midterms.html" class="tocviewlink" data-pltdoc="x">Midterms</a></td></tr><tr><td align="right"></td><td><a href="Project.html" class="tocviewlink" data-pltdoc="x">Project</a></td></tr><tr><td align="right"></td><td><a href="Software.html" class="tocviewlink" data-pltdoc="x">Software</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9660;</a></td><td></td><td><a href="Notes.html" class="tocviewlink" data-pltdoc="x">Notes</a></td></tr></table><div class="tocviewsublist" style="display: block;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Intro.html" class="tocviewlink" data-pltdoc="x">What <span class="emph">is</span> a Compiler?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="OCaml_to_Racket.html" class="tocviewlink" data-pltdoc="x">From OCaml to Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="a86.html" class="tocviewlink" data-pltdoc="x">a86:<span class="mywbr"> &nbsp;</span> a Little Assembly Language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Abscond.html" class="tocviewlink" data-pltdoc="x">Abscond:<span class="mywbr"> &nbsp;</span> a language of numbers</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Blackmail:<span class="mywbr"> &nbsp;</span> incrementing and decrementing</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Con.html" class="tocviewlink" data-pltdoc="x">Con:<span class="mywbr"> &nbsp;</span> branching with conditionals</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Dupe.html" class="tocviewlink" data-pltdoc="x">Dupe:<span class="mywbr"> &nbsp;</span> a duplicity of types</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Dodger.html" class="tocviewlink" data-pltdoc="x">Dodger:<span class="mywbr"> &nbsp;</span> addressing a lack of character</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Evildoer.html" class="tocviewlink" data-pltdoc="x">Evildoer:<span class="mywbr"> &nbsp;</span> change the world a couple nibbles at a time</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Extort.html" class="tocviewlink" data-pltdoc="x">Extort:<span class="mywbr"> &nbsp;</span> when errors exist</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="Fraud.html" class="tocviewlink" data-pltdoc="x">Fraud:<span class="mywbr"> &nbsp;</span> local binding, variables, and binary operations</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Hustle.html" class="tocviewlink" data-pltdoc="x">Hustle:<span class="mywbr"> &nbsp;</span> heaps and lists</a></td></tr><tr><td align="right">13&nbsp;</td><td><a href="Hoax.html" class="tocviewlink" data-pltdoc="x">Hoax:<span class="mywbr"> &nbsp;</span> vectors and strings</a></td></tr><tr><td align="right">14&nbsp;</td><td><a href="Iniquity.html" class="tocviewlink" data-pltdoc="x">Iniquity:<span class="mywbr"> &nbsp;</span> function definitions and calls</a></td></tr><tr><td align="right">15&nbsp;</td><td><a href="Jig.html" class="tocviewlink" data-pltdoc="x">Jig:<span class="mywbr"> &nbsp;</span> jumping to tail calls</a></td></tr><tr><td align="right">16&nbsp;</td><td><a href="Knock.html" class="tocviewlink" data-pltdoc="x">Knock:<span class="mywbr"> &nbsp;</span> pattern matching</a></td></tr><tr><td align="right">17&nbsp;</td><td><a href="Loot.html" class="tocviewlink" data-pltdoc="x">Loot:<span class="mywbr"> &nbsp;</span> lambda the ultimate</a></td></tr><tr><td align="right">18&nbsp;</td><td><a href="Mug.html" class="tocviewlink" data-pltdoc="x">Mug:<span class="mywbr"> &nbsp;</span> symbols and interned string literals</a></td></tr><tr><td align="right">19&nbsp;</td><td><a href="Mountebank.html" class="tocviewlink" data-pltdoc="x">Mountebank:<span class="mywbr"> &nbsp;</span> quote and compound static data</a></td></tr><tr><td align="right">20&nbsp;</td><td><a href="Neerdowell.html" class="tocviewlink" data-pltdoc="x">Neerdowell:<span class="mywbr"> &nbsp;</span> structures</a></td></tr><tr><td align="right">21&nbsp;</td><td><a href="Outlaw.html" class="tocviewlink" data-pltdoc="x">Outlaw:<span class="mywbr"> &nbsp;</span> self-<wbr></wbr>hosting</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_2&quot;);">&#9658;</a></td><td>5&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Blackmail:<span class="mywbr"> &nbsp;</span> incrementing and decrementing</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_2"><table cellspacing="0" cellpadding="0"><tr><td align="right">5.1&nbsp;</td><td><a href="#%28part._.Refinement__take_one%29" class="tocviewlink" data-pltdoc="x">Refinement, take one</a></td></tr><tr><td align="right">5.2&nbsp;</td><td><a href="#%28part._.Concrete_syntax_for_.Blackmail%29" class="tocviewlink" data-pltdoc="x">Concrete syntax for Blackmail</a></td></tr><tr><td align="right">5.3&nbsp;</td><td><a href="#%28part._.Abstract_syntax_for_.Blackmail%29" class="tocviewlink" data-pltdoc="x">Abstract syntax for Blackmail</a></td></tr><tr><td align="right">5.4&nbsp;</td><td><a href="#%28part._.Meaning_of_.Blackmail_programs%29" class="tocviewlink" data-pltdoc="x">Meaning of Blackmail programs</a></td></tr><tr><td align="right">5.5&nbsp;</td><td><a href="#%28part._.An_.Example_of_.Blackmail_compilation%29" class="tocviewlink" data-pltdoc="x">An Example of Blackmail compilation</a></td></tr><tr><td align="right">5.6&nbsp;</td><td><a href="#%28part._.A_.Compiler_for_.Blackmail%29" class="tocviewlink" data-pltdoc="x">A Compiler for Blackmail</a></td></tr><tr><td align="right">5.7&nbsp;</td><td><a href="#%28part._.Correctness_and_random_testing%29" class="tocviewlink" data-pltdoc="x">Correctness and random testing</a></td></tr><tr><td align="right">5.8&nbsp;</td><td><a href="#%28part._.Looking_back__looking_forward%29" class="tocviewlink" data-pltdoc="x">Looking back, looking forward</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.Refinement__take_one%29" class="tocsubseclink" data-pltdoc="x">Refinement, take one</a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._.Concrete_syntax_for_.Blackmail%29" class="tocsubseclink" data-pltdoc="x">Concrete syntax for Blackmail</a></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._.Abstract_syntax_for_.Blackmail%29" class="tocsubseclink" data-pltdoc="x">Abstract syntax for Blackmail</a></td></tr><tr><td><span class="tocsublinknumber">5.4<tt>&nbsp;</tt></span><a href="#%28part._.Meaning_of_.Blackmail_programs%29" class="tocsubseclink" data-pltdoc="x">Meaning of Blackmail programs</a></td></tr><tr><td><span class="tocsublinknumber">5.5<tt>&nbsp;</tt></span><a href="#%28part._.An_.Example_of_.Blackmail_compilation%29" class="tocsubseclink" data-pltdoc="x">An Example of Blackmail compilation</a></td></tr><tr><td><span class="tocsublinknumber">5.6<tt>&nbsp;</tt></span><a href="#%28part._.A_.Compiler_for_.Blackmail%29" class="tocsubseclink" data-pltdoc="x">A Compiler for Blackmail</a></td></tr><tr><td><span class="tocsublinknumber">5.7<tt>&nbsp;</tt></span><a href="#%28part._.Correctness_and_random_testing%29" class="tocsubseclink" data-pltdoc="x">Correctness and random testing</a></td></tr><tr><td><span class="tocsublinknumber">5.8<tt>&nbsp;</tt></span><a href="#%28part._.Looking_back__looking_forward%29" class="tocsubseclink" data-pltdoc="x">Looking back, looking forward</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">8.15</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Abscond.html" title="backward to &quot;4 Abscond: a language of numbers&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Notes.html" title="up to &quot;Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Con.html" title="forward to &quot;6 Con: branching with conditionals&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div><h4 class="heading">5<tt>&nbsp;</tt><a name="(part._.Blackmail)"></a>Blackmail: incrementing and decrementing<span class="button-group"><a href="#(part._.Blackmail)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h4><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><img src="pict_10.png" alt="image" width="37.0" height="24.0"/> <a href="code/blackmail.zip">Source code</a>.</p></blockquote></blockquote></blockquote><p><span class="emph">Let&rsquo;s Do It Again!</span></p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Refinement__take_one%29" class="toclink" data-pltdoc="x">5.1<span class="hspace">&nbsp;</span>Refinement, take one</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Concrete_syntax_for_.Blackmail%29" class="toclink" data-pltdoc="x">5.2<span class="hspace">&nbsp;</span>Concrete syntax for Blackmail</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Abstract_syntax_for_.Blackmail%29" class="toclink" data-pltdoc="x">5.3<span class="hspace">&nbsp;</span>Abstract syntax for Blackmail</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Meaning_of_.Blackmail_programs%29" class="toclink" data-pltdoc="x">5.4<span class="hspace">&nbsp;</span>Meaning of Blackmail programs</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.An_.Example_of_.Blackmail_compilation%29" class="toclink" data-pltdoc="x">5.5<span class="hspace">&nbsp;</span>An Example of Blackmail compilation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.A_.Compiler_for_.Blackmail%29" class="toclink" data-pltdoc="x">5.6<span class="hspace">&nbsp;</span>A Compiler for Blackmail</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Correctness_and_random_testing%29" class="toclink" data-pltdoc="x">5.7<span class="hspace">&nbsp;</span>Correctness and random testing</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Looking_back__looking_forward%29" class="toclink" data-pltdoc="x">5.8<span class="hspace">&nbsp;</span>Looking back, looking forward</a></p></td></tr></table><h5 class="heading">5.1<tt>&nbsp;</tt><a name="(part._.Refinement__take_one)"></a>Refinement, take one<span class="button-group"><a href="#(part._.Refinement__take_one)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>We&rsquo;ve seen all the essential pieces (a grammar, an AST data type
definition, an operational semantics, an interpreter, a compiler,
etc.) for implementing a programming language, albeit for an amazingly
simple language.</p><p>We will now, through a process of <span style="font-weight: bold">iterative refinement</span>, grow
the language to have an interesting set of features.</p><p>Our second language, which subsumes Abscond, is <span style="font-weight: bold">Blackmail</span>.
Expressions in Blackmail include integer literals and increment and
decrement operations.  It&rsquo;s still a dead simple language, but at least
programs <span class="emph">do</span> something.</p><h5 class="heading">5.2<tt>&nbsp;</tt><a name="(part._.Concrete_syntax_for_.Blackmail)"></a>Concrete syntax for Blackmail<span class="button-group"><a href="#(part._.Concrete_syntax_for_.Blackmail)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>A Blackmail program consists of <span class="stt">#lang racket</span> line and a
single expression, and the grammar of concrete expressions
is:</p><blockquote class="SCentered"><p><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_11.png" alt="image" width="193.728515625" height="20.2802734375"/></p></blockquote><p>So, <span class="RktVal">0</span>, <span class="RktVal">120</span>, and <span class="RktVal"><span class="nobreak">-4</span>2</span> are Blackmail expressions,
but so are <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="stt"> </span><span class="RktVal">120</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-4</span>2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><p>An example concrete program:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/blackmail/add1-add1-40.rkt"><span class="stt">blackmail/add1-add1-40.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">40</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><h5 class="heading">5.3<tt>&nbsp;</tt><a name="(part._.Abstract_syntax_for_.Blackmail)"></a>Abstract syntax for Blackmail<span class="button-group"><a href="#(part._.Abstract_syntax_for_.Blackmail)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>The grammar of abstract Backmail expressions is:</p><blockquote class="SCentered"><p><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_12.png" alt="image" width="157.853515625" height="48.560546875"/></p></blockquote><p>So, <span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal">120</span><span class="RktPn">)</span>, and
<span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-4</span>2</span><span class="RktPn">)</span> are Blackmail AST expressions, but so are
<span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span>, <span class="RktPn">(</span><span class="RktSym">Sub1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal">120</span><span class="RktPn">)</span><span class="RktPn">)</span>,
<span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="stt"> </span><span class="RktVal"><span class="nobreak">-4</span>2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><p>A datatype for representing expressions can be defined as:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/blackmail/ast.rkt"><span class="stt">blackmail/ast.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Prim1</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">type</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">=</span><span class="hspace">&nbsp;</span><span class="RktCmt">(Lit</span><span class="hspace">&nbsp;</span><span class="RktCmt">Integer)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">|</span><span class="hspace">&nbsp;</span><span class="RktCmt">(Prim1</span><span class="hspace">&nbsp;</span><span class="RktCmt">Op1</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">type</span><span class="hspace">&nbsp;</span><span class="RktCmt">Op1</span><span class="hspace">&nbsp;</span><span class="RktCmt">=</span><span class="hspace">&nbsp;</span><span class="RktCmt">'add1</span><span class="hspace">&nbsp;</span><span class="RktCmt">|</span><span class="hspace">&nbsp;</span><span class="RktCmt">'sub1</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:prefab</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define-struct.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._struct%29%29" class="RktStxLink" data-pltdoc="x">struct</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">#:prefab</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p>The parser is more involved than Abscond, but still
straightforward:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/blackmail/parse.rkt"><span class="stt">blackmail/parse.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">parse</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"ast.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">S-Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._exact-integer~3f%29%29" class="RktValLink" data-pltdoc="x">exact-integer?</a></span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list-rest</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._symbol~3f%29%29" class="RktValLink" data-pltdoc="x">symbol?</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">k</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">sr</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">k</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">op1?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">o</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">sr</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s1</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">o</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">parse</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"op1:</span><span class="hspace">&nbsp;</span><span class="RktVal">bad</span><span class="hspace">&nbsp;</span><span class="RktVal">syntax"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"parse</span><span class="hspace">&nbsp;</span><span class="RktVal">error"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/exns.html#%28def._%28%28quote._~23~25kernel%29._error%29%29" class="RktValLink" data-pltdoc="x">error</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"parse</span><span class="hspace">&nbsp;</span><span class="RktVal">error"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">op1?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._memq%29%29" class="RktValLink" data-pltdoc="x">memq</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">x</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><h5 class="heading">5.4<tt>&nbsp;</tt><a name="(part._.Meaning_of_.Blackmail_programs)"></a>Meaning of Blackmail programs<span class="button-group"><a href="#(part._.Meaning_of_.Blackmail_programs)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>The meaning of a Blackmail program depends on the form of the expression:</p><ul><li><p>the meaning of an integer literal is just the integer itself,</p></li><li><p>the meaning of an increment expression is one more than the meaning of its subexpression, and</p></li><li><p>the meaning of a decrement expression is one less than the meaning of its subexpression.</p></li></ul><p>The operational semantics reflects this dependence on the form of the
expression by having three rules, one for each kind of expression:</p><blockquote class="SCentered"><p><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_13.png" alt="image" width="70.1513671875" height="29.2802734375"/><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_14.png" alt="image" width="138.6357421875" height="43.4482421875"/><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><img style="vertical-align: -3.5px; margin: -3px -3px -3px -3px;" src="pict_15.png" alt="image" width="137.849609375" height="43.4482421875"/></p></blockquote><p>The first rule looks familiar; it&rsquo;s exactly the semantics of integers
from Abscond.  The second and third rule are more involved.  In
particular, they have <span style="font-weight: bold">premises</span> above the line.  If the premises
are true, the <span style="font-weight: bold">conclusion</span> below the line is true as well.  These
rules are <span class="emph">conditional</span> on the premises being true.  This is in
contrast to the first rule, which applies unconditionally.</p><p><div class="SIntrapara">We can understand these rules as saying the following:
</div><div class="SIntrapara"><ul><li><p>For all integers <span style="font-style: italic">i</span>, <span style="font-style: italic"></span>(<span style="font-style: italic"></span>(<span style="font-style: italic">Lit i</span>)<span style="font-style: italic">,i</span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_16.png" alt="image" width="15.169921875" height="20.0"/>.</p></li><li><p>For expressions <span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and all integers <span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and
<span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>, if <span style="font-style: italic"></span>(<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic">,i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_17.png" alt="image" width="15.169921875" height="20.0"/> and <span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span style="font-style: italic">
</span><span style="font-style: italic">= i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"> + </span>1<span style="font-style: italic"></span>, then <span style="font-style: italic"></span>(<span style="font-style: italic"></span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="stt"> </span><span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktPn">)</span><span style="font-style: italic">, i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span>
is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_18.png" alt="image" width="15.169921875" height="20.0"/>.</p></li><li><p>For expressions <span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and all integers <span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span> and
<span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>, if <span style="font-style: italic"></span>(<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic">,i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_19.png" alt="image" width="15.169921875" height="20.0"/> and <span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span style="font-style: italic">
</span><span style="font-style: italic">= i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"> - </span>1<span style="font-style: italic"></span>, then <span style="font-style: italic"></span>(<span style="font-style: italic"></span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="stt"> </span><span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktPn">)</span><span style="font-style: italic">, i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>1<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span>
is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_20.png" alt="image" width="15.169921875" height="20.0"/>.</p></li></ul></div></p><p>These rules are <span style="font-weight: bold">inductive</span>.  We start from the meaning of
integers and if we have the meaning of an expression, we can construct
the meaning of a larger expression.</p><p>This may seem a bit strange at the moment, but it helps to view the
semantics through its correspondence with an interpreter, which given
an expression <span style="font-style: italic">e</span>, computes an integer <span style="font-style: italic">i</span>, such that
<span style="font-style: italic"></span>(<span style="font-style: italic">e,i</span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_21.png" alt="image" width="15.169921875" height="20.0"/>.</p><p>Just as there are three rules, there will be three cases to the
interpreter, one for each form of expression:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/blackmail/interp.rkt"><span class="stt">blackmail/interp.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">interp</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"ast.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"interp-prim.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Integer</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">interp-prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-7</span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-7</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">42</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">43</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">7</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">11</span></p></td></tr></table></blockquote></div></p><p>Here&rsquo;s how to connect the dots between the semantics and interpreter:
the interpreter is computing, for a given expression <span style="font-style: italic">e</span>, the
integer <span style="font-style: italic">i</span>, such that <span style="font-style: italic"></span>(<span style="font-style: italic">e,i</span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_22.png" alt="image" width="15.169921875" height="20.0"/>.  The
interpreter uses pattern matching to determine the form of the
expression, which determines which rule of the semantics applies.</p><ul><li><p>if <span style="font-style: italic">e</span> is an integer <span style="font-style: italic"></span>(<span style="font-style: italic">Lit i</span>)<span style="font-style: italic"></span>, then we&rsquo;re done: this is the
right-hand-side of the pair <span style="font-style: italic"></span>(<span style="font-style: italic">e,i</span>)<span style="font-style: italic"></span> in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_23.png" alt="image" width="15.169921875" height="20.0"/>.</p></li><li><p>if <span style="font-style: italic">e</span> is an expression <span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="stt"> </span><span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktPn">)</span>, then we recursively use the interpreter to compute
<span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span> such that <span style="font-style: italic"></span>(<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic">,i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_24.png" alt="image" width="15.169921875" height="20.0"/>.  But
now we can compute the right-hand-side by adding 1 to <span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span>.</p></li><li><p>if <span style="font-style: italic">e</span> is an expression <span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="stt"> </span><span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span><span class="RktPn">)</span>, then we recursively use the interpreter to compute
<span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span> such that <span style="font-style: italic"></span>(<span style="font-style: italic">e</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic">,i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span>)<span style="font-style: italic"></span> is in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_25.png" alt="image" width="15.169921875" height="20.0"/>.  But
now we can compute the right-hand-side by substracting 1 from <span style="font-style: italic">i</span><span style="vertical-align: sub; font-size: 80%"><span style="font-style: italic"></span>0<span style="font-style: italic"></span></span><span style="font-style: italic"></span>.</p></li></ul><p>This explanation of the correspondence is essentially a proof by
induction of the interpreter&rsquo;s correctness:</p><p><span style="font-weight: bold">Interpreter Correctness</span>: <span class="emph">For all Blackmail expressions
<span class="RktSym">e</span> and integers <span class="RktSym">i</span>, if (<span class="RktSym">e</span>,<span class="RktSym">i</span>) in
<img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_26.png" alt="image" width="15.169921875" height="20.0"/>, then <span class="RktPn">(</span><span class="RktSym">interp</span><span class="stt"> </span><span class="RktSym">e</span><span class="RktPn">)</span> equals
<span class="RktSym">i</span>.</span></p><h5 class="heading">5.5<tt>&nbsp;</tt><a name="(part._.An_.Example_of_.Blackmail_compilation)"></a>An Example of Blackmail compilation<span class="button-group"><a href="#(part._.An_.Example_of_.Blackmail_compilation)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>Just as we did with Abscond, let&rsquo;s approach writing the compiler by
first writing an example.</p><p>Suppose we want to compile <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktVal">40</span><span class="RktPn">)</span><span class="RktPn">)</span>.  We already
know how to compile the <span class="RktVal">40</span>: <span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Mov%29%29" class="RktValLink" data-pltdoc="x">Mov</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">rax</span><span class="stt"> </span><span class="RktVal">40</span><span class="RktPn">)</span>.  To do
the increment (and decrement) we need to know a bit more x86-64.  In
particular, the <span class="stt">add</span> (and <span class="stt">sub</span>) instruction is relevant.  It
increments the contents of a register by some given amount.</p><p>Concretely, the program that adds 1 twice to 40 looks like:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/add1-add1-40.s"><span class="stt">add1-add1-40.s</span></a></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode nasm"><code class="sourceCode nasm"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>        default rel</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">section</span> .text</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">global</span> <span class="dv">$</span>_entry</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">$_entry:</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">mov</span> rax, <span class="dv">40</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">add</span> rax, <span class="dv">1</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">add</span> rax, <span class="dv">1</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ret</span></span></code></pre></div>
</p></blockquote></blockquote><p>The runtime stays exactly the same as before.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> make add1-add1-40.run</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nasm</span> -g -f macho64 -o add1-add1-40.o add1-add1-40.s</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arch</span> -x86_64 gcc runtime.o add1-add1-40.o -o add1-add1-40.run</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> add1-add1-40.o</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ld:</span> warning: no platform load command found in &#39;<span class="st">/Users/anwar/Library/Racket/8.15/pkgs/langs/blackmail/add1-add1-40.o&#39;</span>, assuming: macOS</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ./add1-add1-40.run</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>42</span></code></pre></div>
</p></blockquote></blockquote><h5 class="heading">5.6<tt>&nbsp;</tt><a name="(part._.A_.Compiler_for_.Blackmail)"></a>A Compiler for Blackmail<span class="button-group"><a href="#(part._.A_.Compiler_for_.Blackmail)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>To compile Blackmail, we make use of two more a86
instructions, <span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Add%29%29" class="RktValLink" data-pltdoc="x">Add</a></span> and <span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Sub%29%29" class="RktValLink" data-pltdoc="x">Sub</a></span>:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fprinter..rkt%29._asm-display%29%29" class="RktValLink" data-pltdoc="x">asm-display</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Label%29%29" class="RktValLink" data-pltdoc="x">Label</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">entry</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Mov%29%29" class="RktValLink" data-pltdoc="x">Mov</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">rax</span><span class="hspace">&nbsp;</span><span class="RktVal">40</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Add%29%29" class="RktValLink" data-pltdoc="x">Add</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">rax</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Add%29%29" class="RktValLink" data-pltdoc="x">Add</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">rax</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Ret%29%29" class="RktValLink" data-pltdoc="x">Ret</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">default rel</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">section .text</span></p></td></tr><tr><td><p><span class="RktOut">$_entry:</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">mov rax, 40</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">add rax, 1</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">add rax, 1</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">ret</span></p></td></tr></table></td></tr></table></blockquote></blockquote></blockquote><p>The compiler consists of two functions: the first, which is given a
program, emits the entry point and return instructions, invoking
another function to compile the expression:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><a href="code/blackmail/compile.rkt"><span class="stt">blackmail/compile.rkt</span></a></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="hspace">&nbsp;&nbsp;</span><a href="http://docs.racket-lang.org/guide/Module_Syntax.html#%28part._hash-lang%29" class="RktModLink" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="http://docs.racket-lang.org/reference/index.html" class="RktModLink" data-pltdoc="x"><span class="RktSym">racket</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile-e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"ast.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"compile-ops.rkt"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a86/ast</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="../../../../../Library/Racket/8.15/pkgs/a86/a86/doc/a86/index.html#%28def._%28%28lib._a86%2Fregisters..rkt%29._rax%29%29" class="RktValLink" data-pltdoc="x">rax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym"><a href="../../../../../Library/Racket/8.15/pkgs/a86/a86/doc/a86/index.html#%28def._%28%28lib._a86%2Fregisters..rkt%29._rax%29%29" class="RktValLink" data-pltdoc="x">rax</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Asm</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._prog%29%29" class="RktValLink" data-pltdoc="x">prog</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Global%29%29" class="RktValLink" data-pltdoc="x">Global</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym">entry</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Label%29%29" class="RktValLink" data-pltdoc="x">Label</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">'</a></span><span class="RktSym">entry</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-e</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Ret%29%29" class="RktValLink" data-pltdoc="x">Ret</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Asm</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-e</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match%29%29" class="RktStxLink" data-pltdoc="x">match</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._seq%29%29" class="RktValLink" data-pltdoc="x">seq</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._.Mov%29%29" class="RktValLink" data-pltdoc="x">Mov</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="../../../../../Library/Racket/8.15/pkgs/a86/a86/doc/a86/index.html#%28def._%28%28lib._a86%2Fregisters..rkt%29._rax%29%29" class="RktValLink" data-pltdoc="x">rax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Op1</span><span class="hspace">&nbsp;</span><span class="RktCmt">Expr</span><span class="hspace">&nbsp;</span><span class="RktCmt">-&gt;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Asm</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-prim1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fast..rkt%29._seq%29%29" class="RktValLink" data-pltdoc="x">seq</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-e</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-op1</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">p</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">&#160;</span></td></tr></table></blockquote></blockquote><p>Notice that <span class="RktSym">compile-e</span> is defined by structural
recursion, much like the interpreter.</p><p>We can now try out a few examples:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">40</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Global 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Label 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Mov 'rax 40)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Add 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Add 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Ret))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Global 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Label 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Mov 'rax 8)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Sub 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Ret))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-8</span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Global 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Label 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Mov 'rax -8)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Add 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Sub 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Add 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Add 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Ret))</span></p></td></tr></table></td></tr></table></blockquote></blockquote></blockquote><p>And give a command line wrapper for parsing, checking, and compiling
in <a href="code/blackmail/compile-stdin.rkt"><span class="stt">compile-stdin.rkt</span></a>,
we can compile files as follows:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> cat add1-add1-40.rkt | racket -t compile-stdin.rkt -m</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">default</span> rel</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">section</span> .text</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">global</span> <span class="va">$_entry</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>$<span class="fu">_entry:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mov</span> rax, 40</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add</span> rax, 1</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add</span> rax, 1</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ret</span></span></code></pre></div>
</p></blockquote></blockquote><p>And using the same <a href="code/blackmail/Makefile"><span class="stt">Makefile</span></a>
setup as in Abscond, we capture the whole compilation process with a
single command:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">shell</span></span></p><blockquote class="Rfilecontent"><p><div class="sourceCode" id="cb1"><pre
class="sourceCode fish"><code class="sourceCode fish"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> make add1-add1-40.run</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> add1-add1-40.rkt <span class="kw">|</span> <span class="fu">racket</span> -t compile-stdin.rkt -m <span class="op">&gt;</span> add1-add1-40.s</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nasm</span> -g -f macho64 -o add1-add1-40.o add1-add1-40.s</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">arch</span> -x86_64 gcc runtime.o add1-add1-40.o -o add1-add1-40.run</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> add1-add1-40.o</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ld:</span> warning: no platform load command found in &#39;<span class="st">/Users/anwar/Library/Racket/8.15/pkgs/langs/blackmail/add1-add1-40.o&#39;</span>, assuming: macOS</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="er">&gt;</span> ./add1-add1-40.run</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>42</span></code></pre></div>
</p></blockquote></blockquote><p>Likewise, to test the compiler from within Racket, we use
the same <span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span> function to encapsulate running
assembly code:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">40</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">42</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">7</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-8</span></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-4</span></p></td></tr></table></blockquote></blockquote></blockquote><h5 class="heading">5.7<tt>&nbsp;</tt><a name="(part._.Correctness_and_random_testing)"></a>Correctness and random testing<span class="button-group"><a href="#(part._.Correctness_and_random_testing)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>We can state correctness similarly to how it was stated for Abscond:</p><p><span style="font-weight: bold">Compiler Correctness</span>: <span class="emph">For all expressions <span class="RktSym">e</span> and
integers <span class="RktSym">i</span>, if (<span class="RktSym">e</span>,<span class="RktSym">i</span>) in <img style="vertical-align: -3.33203125px; margin: -3px -3px -3px -3px;" src="pict_27.png" alt="image" width="15.169921875" height="20.0"/>, then <span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="stt"> </span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span> equals
<span class="RktSym">i</span>.</span></p><p>And we can test this claim by comparing the results of running
compiled and interpreted programs, leading to the following property,
which hopefully holds:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-eqv?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></blockquote></blockquote><p>The problem, however, is that generating random Blackmail programs is
less obvious compared to generating random Abscond programs
(i.e. random integers).  Randomly generating programs for testing is
its own well studied and active research area.  To side-step this
wrinkle, we have provided a small utility for generating random
Blackmail programs (<a href="code/blackmail/random.rkt">random.rkt</a>),
which you can use, without needing the understand how it was
implemented.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"random.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#s(Prim1 sub1 #s(Lit -9))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'#s(Prim1</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">add1</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#s(Prim1</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">add1</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#s(Prim1 sub1 #s(Prim1 add1 #s(Lit -1)))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#s(Lit 3)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'#s(Prim1</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">sub1</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">#s(Prim1 sub1 #s(Prim1 add1 #s(Lit -32))))</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'#s(Prim1 sub1 #s(Prim1 sub1 #s(Lit 3)))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">e</span></td></tr><tr><td><p><span class="RktRes">'#s(Prim1 add1 #s(Lit -6))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">(list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Global 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Label 'entry)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Mov 'rax -6)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Add 'rax 1)</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes">(Ret))</span></p></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%29%29" class="RktStxLink" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-range%29%29" class="RktValLink" data-pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">random-expr</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></blockquote></blockquote><p>It&rsquo;s now probably time to acknowledge a short-coming in our
compiler. Although it&rsquo;s great that random testing is
confirming the correctness of the compiler on
<span class="emph">specific</span> examples, the compiler is unfortunately not
correct in general.  Neither was the Abscond compiler.</p><p>To see why, recall that integers in Blackmail are
represented as 64-bit values in the compiled code. The
problem arises when 64 bits isn&rsquo;t enough. Since the run-time
system interprets the 64-bit values as a <span class="emph">signed</span>
integer, we have 1 bit devoted to the sign and 63 bits
devoted to the magnitude of the integer. So the largest
number we can represent is <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._expt%29%29" class="RktValLink" data-pltdoc="x">expt</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">63</span><span class="RktPn">)</span><span class="RktPn">)</span> and
the smallest number is <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._expt%29%29" class="RktValLink" data-pltdoc="x">expt</a></span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">63</span><span class="RktPn">)</span><span class="RktPn">)</span>. What
happens if a program exceeds these bounds? Well, whatever
x86 does.  Let&rsquo;s see:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">max-int</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._sub1%29%29" class="RktValLink" data-pltdoc="x">sub1</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._expt%29%29" class="RktValLink" data-pltdoc="x">expt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">63</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">min-int</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._-%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._expt%29%29" class="RktValLink" data-pltdoc="x">expt</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">63</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">max-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">9223372036854775807</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">max-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-9223372036854775808</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">min-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-9223372036854775808</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Finterp..rkt%29._asm-interp%29%29" class="RktValLink" data-pltdoc="x">asm-interp</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">compile</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">min-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">9223372036854775807</span></p></td></tr></table></blockquote></blockquote></blockquote><p>Now there&rsquo;s a fact you didn&rsquo;t learn in grade school: in the
first example, adding 1 to a number made it smaller; in the
second, subtracting 1 made it bigger!</p><p>This problem doesn&rsquo;t exist in the interpreter:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">max-int</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">9223372036854775807</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">max-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">9223372036854775808</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">min-int</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-9223372036854775808</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interp</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">min-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">-9223372036854775809</span></p></td></tr></table></blockquote></blockquote></blockquote><p>So we have found a counter-example to the claim of compiler
correctness:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="emph">Examples</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">max-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">--------------------</span></p></td></tr><tr><td><p><span class="RktErr">FAILURE</span></p></td></tr><tr><td><p><span class="RktErr">name: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">check-eqv?</span></p></td></tr><tr><td><p><span class="RktErr">location: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">eval:153:0</span></p></td></tr><tr><td><p><span class="RktErr">actual: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">9223372036854775808</span></p></td></tr><tr><td><p><span class="RktErr">expected: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">-9223372036854775808</span></p></td></tr><tr><td><p><span class="RktErr">--------------------</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">check-compiler</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Prim1</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">Lit</span><span class="hspace">&nbsp;</span><span class="RktSym">min-int</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktErr">--------------------</span></p></td></tr><tr><td><p><span class="RktErr">FAILURE</span></p></td></tr><tr><td><p><span class="RktErr">name: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">check-eqv?</span></p></td></tr><tr><td><p><span class="RktErr">location: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">eval:153:0</span></p></td></tr><tr><td><p><span class="RktErr">actual: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">-9223372036854775809</span></p></td></tr><tr><td><p><span class="RktErr">expected: </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">9223372036854775807</span></p></td></tr><tr><td><p><span class="RktErr">--------------------</span></p></td></tr></table></td></tr></table></blockquote></blockquote></blockquote><p>What can we do? This is the basic problem of a program not
satisfying its specification.  We have two choices:</p><ul><li><p>change the spec (i.e. the semantics and interpreter)</p></li><li><p>change the program (i.e. the compiler)</p></li></ul><p>We could change the spec to make it match the behaviour of
the compiler. This would involve writing out definitions
that match the &ldquo;wrapping&rdquo; behavior we see in the compiled
code. Of course if the specification is meant to capture
what Racket actually does, taking this route would be a
mistake. Even independent of Racket, this seems like a
questionable design choice. Wouldn&rsquo;t it be nice to reason
about programs using the usual laws of mathematics (or at
least something as close as possible to what we think of as
math)? For example, wouldn&rsquo;t you like know that
<span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3c%29%29" class="RktValLink" data-pltdoc="x">&lt;</a></span><span class="stt"> </span><span class="RktSym">i</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._add1%29%29" class="RktValLink" data-pltdoc="x">add1</a></span><span class="stt"> </span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">)</span> for all integers <span class="RktSym">i</span>?</p><p>Unforunately, the other choice seems to paint us in to a
corner. How can we ever hope to represent all possible
integers in just 64 bits? We can&rsquo;t. We need some new tricks.
So in the meantime, our compiler is not correct, but writing
down what it means to be correct is half the battle. We will
get to correctness, but for the time being, we view the
specification aspirationally.</p><h5 class="heading">5.8<tt>&nbsp;</tt><a name="(part._.Looking_back__looking_forward)"></a>Looking back, looking forward<span class="button-group"><a href="#(part._.Looking_back__looking_forward)" class="heading-anchor" title="Link to here">🔗</a><span style="visibility: hidden"> </span></span></h5><p>We&rsquo;ve now built two compilers; enough to start observing a pattern.</p><p>Recall the phases of a compiler described in
<a href="Intro.html#%28part._.What._does._a._.Compiler._look._like~3f%29" data-pltdoc="x">What does a Compiler <span class="emph">look</span> like?</a>. Let&rsquo;s identify
these pieces in the two compilers we&rsquo;ve written:</p><ul><li><p><span style="font-weight: bold">Parsed</span> into a data structure called an <span style="font-weight: bold">Abstract Syntax Tree</span></p><ul><li><p>we use <span class="RktSym"><a href="http://docs.racket-lang.org/reference/Reading.html#%28def._%28%28quote._~23~25kernel%29._read%29%29" class="RktValLink" data-pltdoc="x">read</a></span> to parse text into a s-expression</p></li></ul><ul><li><p>we use <span class="RktSym">parse</span> to convert an s-expression into an AST</p></li></ul></li><li><p><span style="font-weight: bold">Checked</span> to make sure code is well-formed (and well-typed)</p></li><li><p><span style="font-weight: bold">Simplified</span> into some convenient <span style="font-weight: bold">Intermediate Representation</span></p><ul><li><p>we don&rsquo;t do any; the AST is the IR</p></li></ul></li><li><p><span style="font-weight: bold">Optimized</span> into (equivalent) but faster program</p><ul><li><p>we don&rsquo;t do any</p></li></ul></li><li><p><span style="font-weight: bold">Generated</span> into assembly x86</p><ul><li><p>we use <span class="RktSym">compile</span> to generate assembly (in AST form),
and use <span class="RktSym"><a href="a86.html#%28def._%28%28lib._a86%2Fprinter..rkt%29._asm-display%29%29" class="RktValLink" data-pltdoc="x">asm-display</a></span> to print concrete X86-64 code</p></li></ul></li><li><p><span style="font-weight: bold">Linked</span> against a run-time (usually written in C)</p><ul><li><p>we link against our run-time written in <span class="stt">main.c</span></p></li></ul></li></ul><p>Our recipe for building compiler involves:</p><ol><li><p>Build intuition with <span style="font-weight: bold">examples</span>,</p></li><li><p>Model problem with <span style="font-weight: bold">data types</span>,</p></li><li><p>Implement compiler via <span style="font-weight: bold">type-transforming-functions</span>,</p></li><li><p>Validate compiler via <span style="font-weight: bold">tests</span>.</p></li></ol><p>As we move forward, the language we are compiling will grow.  As the
language grows, you should apply this recipe to grow the compiler
along with the language.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;<span class="tocsettoggle">&nbsp;&nbsp;<a href="javascript:void(0);" title="show/hide table of contents" onclick="TocsetToggle();">contents</a></span></span><span class="navright">&nbsp;&nbsp;<a href="Abscond.html" title="backward to &quot;4 Abscond: a language of numbers&quot;" data-pltdoc="x" rel="prev">&larr; prev</a>&nbsp;&nbsp;<a href="Notes.html" title="up to &quot;Notes&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Con.html" title="forward to &quot;6 Con: branching with conditionals&quot;" data-pltdoc="x" rel="next">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>